<% @user = current_user %>
<div class="container">

  <div class="card1">
    <h3>Your open requests</h3>
    <% if @my_requests.empty? %>
      <p>You haven't created any requests yet.</p>
      <%# @my_requests.each do |request| %>
    <% else %>
      <% request = @my_requests.last %>
        <p>Location: <%= request.city %></p>
        <p>Max. price: <%= request.budget %></p>
        <%= link_to "See more", request_path(request) %>
      <%# end %>
      <% end %>
  </div>


  <div class="cards">
    <div class="card2">
      <h3>Your offers</h3>
      <%# @my_offers.flatten.each do |offer| %>
      <% if @my_requests.empty? %>
        <p>You don't have any offers yet.</p>
      <% else %>
        <% offers = request.offers %>  
        <% if offers.empty?  %>
          <p>You don't have any offers yet.</p>
        <% else %>
          <% offers.each do |offer| %>
            <p></p>
            <p>Offer by: <%= User.find(offer.creator_id).first_name %> <%= User.find(offer.creator_id).last_name %></p>
            <p>Offer created at: <%= offer.created_at %></p>
            <p>Offer status: <%= offer.status %></p>
            <%= link_to "View offer", request_offer_path(offer.request, offer) %>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <div class="card3">
      <h3>Friends asking for help</h3>
      <% shares = @user.private_shares %>
      <% if shares.empty? %>
        <p>Nobody has asked you for help yet. </p>
      <% else %>
        <% shares.each do |share| %>
          <% request = share.request %>
          <% sharer = User.find(share.sharer_id)%>
          <% reshare = sharer != request.user %>
          <div class="card-friend pb-2 status-notification">
            <% if share.request.user.photo %>
              <%= image_tag share.request.user.photo %>
            <% else %>
            <img src="https://t4.ftcdn.net/jpg/00/64/67/63/240_F_64676383_LdbmhiNM6Ypzb3FM4PPuFP9rHe7ri8Ju.jpg">
            <% end %>
            <div class="card-friend-infos">
              <%# Request is new or offer has been made already? %>
              <% if request.offers.any? { |offer| offer.creator_id == @user.id } %>
                <span class="status-label orange">CONTACTED</span>
              <% elsif share.shared %>
                <span class="status-label orange">SHARED</span>
              <% else %>
                <span class="status-label green">NEW</span>
              <% end %>
              <%#  %>
              <% if reshare %>
                <p><%= sharer.first_name %> thinks you could help <strong><%= share.request.user.first_name %></strong> find a room.</p>
                <p><%= link_to "View request", request_path(request) %></p>
              <% else %>
                <p><strong><%= share.request.user.first_name %> <%= share.request.user.last_name %></strong> is looking for a room.</p>
                <p>Can you help?</p>
                <p><%= link_to "View request", request_path(request) %></p>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>


